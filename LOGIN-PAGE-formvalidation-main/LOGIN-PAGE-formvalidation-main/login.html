<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirect Page</title>
    <script src="redirect.js"></script>
    <link rel="stylesheet" href="loginstyle.css">
</head>

<body>
    <div id="msg">
        <span class="msg-text">NO DATA FOUND</span>
    </div>
    <div class="container">
        <div id="table-container">
            <h3>TABLE</h3>
            <button class="clearAllBtn" onclick="clearFields()">CLEAR ALL</button>

            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>PASSWORD</th>
                        <th>NAME</th>
                        <th>EMAIL</th>
                        <th>OPTIONS</th>
                    </tr>
                </thead>
                <tbody id="table-body">

                </tbody>
            </table>
        </div>
    </div>
    <script>
        let storedData;
        if (localStorage.getItem('responsekey')) {
            storedData = JSON.parse(localStorage.getItem('responsekey'));
        }

        const tableBody = document.getElementById('table-body');

        storedData.forEach((item, index) => {

            const row = document.createElement('tr');

            for (const key in item) {
                if (key == 'id' || key == 'username' || key == 'email' || key == 'password') {
                    const cell = document.createElement('td');
                    cell.textContent = item[key];
                    row.appendChild(cell);
                }
            }
            let newCell = row.insertCell(4)
            tableBody.appendChild(row);
            let btn1 = document.createElement('button');
            let btn2 = document.createElement('button');
            btn1.textContent = "Edit"
            btn1.className="editbtn"
            btn2.textContent = "Delete"
            btn2.className="deletebtn"
            newCell.appendChild(btn1)
            newCell.appendChild(btn2)
            btn1.addEventListener("click", (event) => {
                rowEdit(event)
                // saveData(event,index,key)
            })
            btn2.addEventListener("click", (event) => {
                rowDelete(event)
                // saveData(event,index,key)
            })

        });

        function rowDelete(event) {
            const clickedElement = event.target;
            const row = clickedElement.closest('tr');
            const delIndex = Array.from(tableBody.children).indexOf(row);
            tableBody.deleteRow(delIndex)
            storedData.splice(delIndex, 1)
            localStorage.setItem('responsekey', JSON.stringify(storedData));
        }
        const arr = [{ 'id': "" }, { 'password': "" }, { 'username': "" }, { 'email': "" }, { 'options': "" }]
        function rowEdit(event) {
            const clickedElement = event.target;
            const row = clickedElement.closest('tr');
            const cells = row.querySelectorAll('td');
            const Index = Array.from(tableBody.children).indexOf(row);

            for (let i = 1; i < cells.length - 1; i++) {
                cells[i].setAttribute('contenteditable', 'true');
                cells[i].addEventListener('input', (event) => {
                    console.log(i);
                    const key = event.target.parentElement.parentElement.parentElement.children[0]
                    const keys = Object.keys(arr[i]);
                    console.log(keys)
                    const newValue = event.target.textContent;
                    saveData(Index, keys, newValue);
                });
            }
        }


        function clearFields() {
            //    localStorage.removeItem('responsekey');
            localStorage.clear();
            storedData = ""
            tableBody.innerHTML = ""
            document.getElementById("msg").style.display="block"
        }
        

        function saveData(ind, key, newValue) {
            // // const newValue=event.target.textContent;
            storedData[ind][key] = newValue;
            localStorage.setItem('responsekey', JSON.stringify(storedData));
        }

    </script>
</body>

</html>