<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirect Page</title>
    <style>
        table,
        th,
        td {
            border: 1px solid black;
            border-collapse: collapse;
            padding:5px;
            text-align: center;
        }
        table{
            width: 100%;
        }
        h3{
            text-align: center;
        }
        .clearAllBtn{
            float: right;
        }
    </style>
</head>

<body>
    <div id="table-container">
        <h3>TABLE</h3>
        <button class="clearAllBtn" onclick="clearFields()">Clear All</button>
        
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>PASSWORD</th>
                    <th>NAME</th>
                    <th>EMAIL</th>
                    <th>OPTIONS</th>
                </tr>
            </thead>
            <tbody id="table-body">

            </tbody>
        </table>
    </div>

    <script>
        let storedData;
        if (localStorage.getItem('responsekey')) {
            storedData = JSON.parse(localStorage.getItem('responsekey'));
        }

        const tableBody = document.getElementById('table-body');
        function saveData(event,index,key){
            const newValue=event.target.textContent;
            storedData[index][key]=newValue;
            localStorage.setItem('responsekey',JSON.stringify(storedData));
        }

        storedData.forEach((item,index) => {
            let i=0;
            const row=document.createElement('tr');
            let f=0;
            for(const key in item){
                if(key=='id'||key=='username'||key=='email'||key=='password'){
                const cell=document.createElement('td');
                cell.textContent=item[key];
                row.appendChild(cell);
            }
            }
            let newCell=row.insertCell(4)
            tableBody.appendChild(row);
            let btn1=document.createElement('button');
            let btn2=document.createElement('button');
            btn1.textContent="EDIT"
            btn2.textContent="DELETE"
            newCell.appendChild(btn1)
            newCell.appendChild(btn2)
            btn1.addEventListener("click",(event) => {
                rowEdit(event,index)
                saveData(event,index,key)
            })
            btn2.addEventListener("click",(event) => {
                rowDelete(event,index)
                saveData(event,index,key)
            })
        
        });

        function rowDelete(event,index){
            const clickedElement=event.target;
            const row=clickedElement.closest('tr');
            const delIndex=Array.from(tableBody.children).indexOf(row);
            tableBody.deleteRow(delIndex)
        }
        function rowEdit(event,index){
            const clickedElement=event.target;
            const row=clickedElement.closest('tr');
            const EditIndex=Array.from(tableBody.children).indexOf(row);
            
            row.setAttribute('contenteditable','true');
            row.addEventListener('input',(event) => 
                saveData(event,index,key));
        }

        
        // function clearFields(){
        //    localStorage.clear();
        // }
    </script>
</body>

</html>